/*! ufobal-libs 2023-05-21 */
var app=angular.module("ufobal-manage-stats",["djng.urls","ui.sortable"]);app.config(["$httpProvider",function(a){a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken"}]);var genders=[{id:"man",text:"muž"},{id:"woman",text:"žena"}];app.service("backend",["$http","djangoUrl","$filter",function(a,b,c){var d=function(a){a.birthdate=a.birthdate?new Date(a.birthdate):null};this.get_players=function(){return a.get(b.reverse("api:get_players")).then(function(a){angular.forEach(a.data,function(a){d(a)})})},this.get_player=function(c){return a.get(b.reverse("api:get_player",[c]))},this.get_tournaments=function(){return a.get(b.reverse("api:get_tournaments"))},this.addAttendance=function(c,d){return a.post(b.reverse("api:add_attendance"),{player:c,team:d})},this.removeAttendance=function(c,d){return a["delete"](b.reverse("api:remove_attendance",[c,d]))},this.save_player=function(d){d.saving=!0;var e=angular.copy(d);return e.birthdate=c("date")(e.birthdate,"yyyy-MM-dd"),a.post(b.reverse("api:save_player"),e).then(function(a){return d.saving=!1,a.data})["catch"](function(a){throw d.saving=!1,a.data})},this.save_team_ranks=function(c){var d=angular.copy(c);return a.post(b.reverse("managestats:set_tournament_ranking"),d)},this.approvePairingRequest=function(c){return a.post(b.reverse("api:approve_pairing_request",[c]),{})},this.denyPairingRequest=function(c){return a.post(b.reverse("api:deny_pairing_request",[c]),{})}}]),app.controller("sortableController",["$scope","$window","backend",function(a,b,c){a.teams=b.teams,a.save_team_ranks=c.save_team_ranks}]),app.controller("pairing",["$scope","backend",function(a,b){a.approve=function(a){b.approvePairingRequest(a).then(function(){alert("Spárováno")})["catch"](function(a){alert("Chyba: "+a.data)})},a.deny=function(a){b.denyPairingRequest(a).then(function(){alert("Zamítnuto")})["catch"](function(a){alert("Chyba: "+a.data)})}}]),app.controller("player-detail",["$scope","backend","$location",function(a,b,c){var d=parseInt(c.$$absUrl.split("/").slice(-1)[0]),e=function(){a.loading=!0,b.get_player(d).then(function(b){return a.player=b.data,a.loading=!1,b.data})};a.genders=genders,a.compute_age=function(){if(a.player.birthdate){var b=Date.now()-Date.parse(a.player.birthdate),c=new Date(b);a.player.age=Math.abs(c.getUTCFullYear()-1970)}},a.save=function(){b.save_player(a.player).then(function(){a.edit=!1})},a.addAttendance=function(){b.addAttendance(a.player.pk,a.selectedTeam).then(e)},a.removeAttendance=function(c,d){b.removeAttendance(a.player.pk,c).then(e)},e(),b.get_tournaments().then(function(b){a.tournaments=b.data})}]),app.controller("player-bulk-edit",["$scope","backend",function(a,b){a.genders=genders,a.$watch("players",function(b,c){b&&(a.changed=!1,a.saving=!1,angular.forEach(b,function(b,c){a.changed=a.changed||b.changed,a.saving=a.saving||b.saving}))},!0),a.save=function(){angular.forEach(a.players,function(a,c){a.changed&&b.save_player(a).then(function(){a.changed=!1})})},b.get_players().then(function(b){a.players=b})}]);